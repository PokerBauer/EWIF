var Produkte = [
    { //Geschenkset
        name: "Schokoadventskalender in Holzschachtel",
        bild: "Schokoadventskalender_in_Holzschachtel",
        preis: 1,
        imWarenkorb: 0,
        id: 1
    },
    {
        name: "Schokolade und Wein Geschenkkorb",
        bild: "Schokolade_und_Wein_Geschenkkorb",
        preis: 2,
        imWarenkorb: 0,
        id: 2
    },
    {
        name: "Schokotorte",
        bild: "Schokotorte",
        preis: 3,
        imWarenkorb: 0,
        id: 3
    },
    {
        name: "Schokowerkzeuge",
        bild: "Schokowerkzeuge",
        preis: 4,
        imWarenkorb: 0,
        id: 4
    },
    {
        name: "Trueffel_Geschenkbox",
        bild: "Trueffel_Geschenkbox",
        preis: 5,
        imWarenkorb: 0,
        id: 5
    },
    { //Pralinen - Vollmilch
        name: "Mix aus Weiss und Vollmilch Dreierlei",
        bild: "Mix_aus_Weiss_und_Vollmilch_Dreierlei",
        preis: 6,
        imWarenkorb: 0,
        id: 6
    },
    {
        name: "Mouse gefuellte Praline",
        bild: "Mouse_gefuellte_Praline",
        preis: 7,
        imWarenkorb: 0,
        id: 7
    },
    {
        name: "Praline mit Mouse und fluessiger Schokolade",
        bild: "Praline_mit_Mouse_und_fluessiger_Schokolade",
        preis: 8,
        imWarenkorb: 0,
        id: 8
    },
    {
        name: "Vollmilch Praline Erdbeertopping",
        bild: "Vollmilch_Praline_Erdbeertopping",
        preis: 9,
        imWarenkorb: 0,
        id: 9
    },
    { //Pralinen - Weiss
        name: "Vollmilch Praline mit Nuss Karamell oder Zartbitter Topping",
        bild: "Vollmilch_Praline_mit_Nuss_Karamell_oder_Zartbitter_Topping",
        preis: 10,
        imWarenkorb: 0,
        id: 10
    },
    {
        name: "Die weissen Berge",
        bild: "Die_weissen_Berge",
        preis: 11,
        imWarenkorb: 0,
        id: 11
    },
    {
        name: "Erdbeertraum",
        bild: "Erdbeertraum",
        preis: 12,
        imWarenkorb: 0,
        id: 12
    },
    {
        name: "Gefuellte Praline mit Mouse Topping",
        bild: "Gefuellte_Praline_mit_Mouse_Topping",
        preis: 13,
        imWarenkorb: 0,
        id: 13
    },
    {
        name: "Kokoskugel mit Nussfuellung",
        bild: "Kokoskugel_mit_Nussfuellung",
        preis: 14,
        imWarenkorb: 0,
        id: 14
    },
    {
        name: "Praline mit Roellchen",
        bild: "Praline_mit_Roellchen",
        preis: 15,
        imWarenkorb: 0,
        id: 15
    },
    { //Pralinen - Zartbitte
        name: "Drei Schokokugeln",
        bild: "Drei_Schokokugeln",
        preis: 16,
        imWarenkorb: 0,
        id: 16
    },
    {
        name: "Mouse gefuellt mit Erdbeerglasur",
        bild: "Mouse_gefuellt_mit_Erdbeerglasur",
        preis: 17,
        imWarenkorb: 0,
        id: 17
    },
    {
        name: "Praline mit fluessigem Kern",
        bild: "Praline_mit_fluessigem_Kern",
        preis: 18,
        imWarenkorb: 0,
        id: 18
    },
    {
        name: "Zartbitterkugel mit Goldglasur",
        bild: "Zartbitterkugel_mit_Goldglasur",
        preis: 19,
        imWarenkorb: 0,
        id: 19
    },
    {
        name: "Zartbitterpraline",
        bild: "Zartbitterpraline",
        preis: 20,
        imWarenkorb: 0,
        id: 20
    },
    { //Tafeln - Vollmilch
        name: "Selbstgemachte Schokolade mit Erdbeer Streuseln oder Nuessen",
        bild: "Selbstgemachte_Schokolade_mit_Erdbeer_Streuseln_oder_Nuessen",
        preis: 21,
        imWarenkorb: 0,
        id: 21
    },
    {
        name: "Tafel mit Tafelfuellung",
        bild: "Tafel_mit_Tafelfuellung",
        preis: 22,
        imWarenkorb: 0,
        id: 22
    },
    {
        name: "Tafel Vollmilch",
        bild: "Tafel_Vollmilch",
        preis: 23,
        imWarenkorb: 0,
        id: 23
    },
    {
        name: "Vollmilchschokolade mit Nuessen und Kokos",
        bild: "Vollmilchschokolade_mit_Nuessen_und_Kokos",
        preis: 24,
        imWarenkorb: 0,
        id: 24
    },
    {
        name: "Vollmilchschokolade mit Nuessen",
        bild: "Vollmilchschokolade_mit_Nuessen",
        preis: 25,
        imWarenkorb: 0,
        id: 25
    },
    { //Tafeln - Weiss
        name: "Luftschokolade",
        bild: "Luftschokolade",
        preis: 26,
        imWarenkorb: 0,
        id: 26
    },
    {
        name: "Tafeln mit Fruechten",
        bild: "Tafeln_mit_Fruechten",
        preis: 27,
        imWarenkorb: 0,
        id: 27
    },
    {
        name: "Weiss und Vollmilch mit Erdbeer",
        bild: "Weiss_und_Vollmilch_mit_Erdbeer",
        preis: 28,
        imWarenkorb: 0,
        id: 28
    },
    {
        name: "Weisse Schokolade mit Nuessen",
        bild: "Weisse_Schokolade_mit_Nuessen",
        preis: 29,
        imWarenkorb: 0,
        id: 29
    },
    {
        name: "Weisse Tafel",
        bild: "Weisse_Tafel",
        preis: 30,
        imWarenkorb: 0,
        id: 30
    },
    { //Tafeln - Zartbitter
        name: "Brownie Zartbittertafel",
        bild: "Brownie_Zartbittertafel",
        preis: 31,
        imWarenkorb: 0,
        id: 31
    },
    {
        name: "Chili Schokolade",
        bild: "Chili_Schokolade",
        preis: 32,
        imWarenkorb: 0,
        id: 32
    },
    {
        name: "Lindtschokolade",
        bild: "Lindtschokolade",
        preis: 33,
        imWarenkorb: 0,
        id: 33
    },
    {
        name: "Zartbitterschokolade mit Nuessen",
        bild: "Zartbitterschokolade_mit_Nuessen",
        preis: 34,
        imWarenkorb: 0,
        id: 34
    },
    {
        name: "Zartbittertafel",
        bild: "Zartbittertafel",
        preis: 35,
        imWarenkorb: 0,
        id: 35
    } //Produkte unter diesem Muster hinzufügen
]//bild soll der Bildname sein -> zum nuten in AusgabeEinkaufswagen(),   TODO: anpassen an richtige Preise

var TestObProductPage = document.querySelectorAll(".produktbild");

function zumWarenkorb(){
    var x = document.querySelector("title");
    var productTEST = x.textContent;

    for(var i = 0; i < Produkte.length; i++) {
        if(productTEST == Produkte[i].bild) {
            var reminder = i;
            //console.log(reminder);
        }
    }

    AnzahlItems(Produkte[reminder]);
    GesamtPreis(Produkte[reminder], "false");
    AusgabeEinkaufswagen();
}


function AnzahlItems(Produkte) {

    //console.log("InAnzahlItems");

    var anzahlProdukte = localStorage.getItem("AnzahlItemsWarenkorb");
    anzahlProdukte = parseInt(anzahlProdukte);

    var inputWithNumberOfItems = document.querySelector(".anzahl");

    var valueOfInput = inputWithNumberOfItems.value;
    valueOfInput = parseInt(valueOfInput);

    console.log(valueOfInput);



    //localStorage.setItem("AnzahlItemsWarenkorb", math);

    if (anzahlProdukte) {
        localStorage.setItem("AnzahlItemsWarenkorb", anzahlProdukte + valueOfInput);
        } else {
        localStorage.setItem("AnzahlItemsWarenkorb", valueOfInput);
    }

    setItems(Produkte);
} //zähler für die anzahl der Prdoukte im WK im LocalStorage


function setItems(Produkte) {
    var ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK);

    var inputWithNumberOfItems = document.querySelector(".anzahl");
    var valueOfInput = inputWithNumberOfItems.value;
    valueOfInput = parseInt(valueOfInput);

    if(ItemsWK != null) { //wenn bereits vorhanden ist
        if(ItemsWK[Produkte.bild] == undefined) {
            ItemsWK = {
                ItemsWK,
                [Produkte.bild] : Produkte
            }
        }
        ItemsWK[Produkte.bild].imWarenkorb = ItemsWK[Produkte.bild].imWarenkorb + valueOfInput;
    } else {
        Produkte.imWarenkorb = valueOfInput; 
        var ItemsWK = {
            [Produkte.bild] : Produkte
        } //erstellen der LS variable und setzung des attributes (?) .imWarenkorb auf die Eingabe im Input feld
    }
    localStorage.setItem("ProdukteImWK", JSON.stringify(ItemsWK))
}//erstellt variable im LocalStorage und erhöht diese um die Eingabe im Input

function GesamtPreis(Produkt, Warenkorb) {
    let TeilPreis = localStorage.getItem("GesamtPreis"); 

    var inputWithNumberOfItems = document.querySelector(".anzahl");
    var valueOfInput = inputWithNumberOfItems.value;
    valueOfInput = parseInt(valueOfInput);

    if(TeilPreis != null && Warenkorb == "false") {
        TeilPreis = parseInt(TeilPreis);
        localStorage.setItem("GesamtPreis", TeilPreis+Produkt.preis*valueOfInput); //erhöht den Preis um den neuen Produkt preis
    } else if (TeilPreis != null && Warenkorb == "plusEins") {
        TeilPreis = parseInt(TeilPreis);
        localStorage.setItem("GesamtPreis", TeilPreis+Produkt.preis); //erhöht den Preis um den neuen Produkt preis
    } else if (TeilPreis != null && Warenkorb == "minusEins") {
        TeilPreis = parseInt(TeilPreis);
        localStorage.setItem("GesamtPreis", TeilPreis-Produkt.preis); //erhöht den Preis um den neuen Produkt preis 
    } else{
        localStorage.setItem("GesamtPreis", Produkt.preis*valueOfInput); //setzt beim erst durchlauf den preis
    }
} //berechnet den Gesamtpreis des Einkaufes



function AusgabeEinkaufswagen(){
    let ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK); //erstellt nutzbare variable mit den aktuellen Warenkorb inhalt

    let InhaltWarenkorb = document.querySelector(".InhaltWarenkorb");
    InhaltWarenkorb.innerHTML = "";

    if(ItemsWK && InhaltWarenkorb)  { //checkt ob es die Warenkorb seite ist
                    Object.values(ItemsWK).map(Item => {
                    InhaltWarenkorb.innerHTML += `
                    <div class="PrdukteWK"> 
                    <button type="Entfernen" onclick="KomplettEntfernen(${Item.id})"> Produkt aus dem Warenkorb entfernen </button>
                    <img src ="Images/Geschenkset/${Item.bild}.PNG"></img>
                    <span>${Item.name}</span>
                    </div>
                    <div class="Preis">${Item.preis},00 Euro</div>
                    <div class="Anzahl">
                    <button type="einsWeniger" onclick="einsWeniger(${Item.id})"> -1 </button>
                    ${Item.imWarenkorb}
                    <button type="einsMehr" onclick="einsMehr(${Item.id})"> +1 </button>
                    </div>
                    <div class="Preise"> Teilpreis:${Item.imWarenkorb*Item.preis},00 Euro</div>
                    `
            });//erstellt html-code der den Warenkorb darstellt
        let TeilPreis = localStorage.getItem("GesamtPreis");
        InhaltWarenkorb.innerHTML += `
        <div class="Gesamtpreis">
        <h4 class="GesamtpreisTitel"> Gesamtpreis:${TeilPreis},00 Euro € </h4>
        </div>
        <button type="WarenkorbLeeren" onclick="WarenkorbLeer()"> Warenkorb komplett leeren</button>
        `
        //erstellt html-code der den Gesamtpreis darstellt
    } else {
        InhaltWarenkorb.innerHTML += `<h3>Ihr Warenkorb ist leer!</h3>`;
    } //Wird nur ausgegeben wenn der Warenkorb leer ist
}

var TestObWarenkorb = document.querySelector(".InhaltWarenkorb");
if(TestObWarenkorb) { //checkt ob es die Warenkorb seite ist
    AusgabeEinkaufswagen(); 
} //ausgabe des warnkorbs beim laden der Warenkorbseite

/*
TODO:
58: anpassen an richtige Preise + richtige Bildnamen und ß schreibbar machen + 58 die tags auf die neuen 15 anpassen
145: €, ß in html ordentlich anzeigen lassen
160+: Die Buttons zum entfernen, +1 und -1 müssen noch entwickelt werden
-> Funktion in Funktion? //rausfinden wie zugriff auf Button innerhalb einer Textausgabe funktionier -> notfalls umschreiben!
*/
//Experimente für die Buttons:

function KomplettEntfernen(ProductID) {
    let ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK); //erstellt nutzbare variable mit den aktuellen Warenkorb inhalt

    ItemsWK[Produkt].imWarenkorb = 0;
} 

function einsMehr(ProductID)  {

    let ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK); //erstellt nutzbare variable mit den aktuellen Warenkorb inhalt

    //console.log(ItemsWK["Schokoadventskalender_in_Holzschachtel"].imWarenkorb);

    for (var i = 0; i < Produkte.length; i++) {
        if(Produkte[i].id == ProductID) {
            var name = Produkte[i].bild;
        }
    }

    ItemsWK[name].imWarenkorb += 1;

    var anzahlProdukte = localStorage.getItem("AnzahlItemsWarenkorb");
    anzahlProdukte = parseInt(anzahlProdukte);
    localStorage.setItem("AnzahlItemsWarenkorb", anzahlProdukte + 1);

    localStorage.setItem("ProdukteImWK", JSON.stringify(ItemsWK))
    GesamtPreis(ItemsWK[name], "plusEins");

    AusgabeEinkaufswagen();
}

function einsWeniger(ProductID) {
    
    let ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK); //erstellt nutzbare variable mit den aktuellen Warenkorb inhalt

    //console.log(ItemsWK["Schokoadventskalender_in_Holzschachtel"].imWarenkorb);

    for (var i = 0; i < Produkte.length; i++) {
        if(Produkte[i].id == ProductID) {
            var name = Produkte[i].bild;
        }
    }

    ItemsWK[name].imWarenkorb -= 1;

    var anzahlProdukte = localStorage.getItem("AnzahlItemsWarenkorb");
    anzahlProdukte = parseInt(anzahlProdukte);
    localStorage.setItem("AnzahlItemsWarenkorb", anzahlProdukte - 1);

    localStorage.setItem("ProdukteImWK", JSON.stringify(ItemsWK))
    GesamtPreis(ItemsWK[name], "minusEins");

    AusgabeEinkaufswagen();
}

function WarenkorbLeer() {
    localStorage.clear();
    AusgabeEinkaufswagen();
}