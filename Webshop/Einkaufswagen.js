var Produkte = [
    { //Geschenkset
        name: "Schokoadventskalender in Holzschachtel",
        bild: "Schokoadventskalender_in_Holzschachtel",
        preis: 25.90,
        imWarenkorb: 0,
        id: 1,
        bildpfad: "Images/Geschenkset/Schokoadventskalender_in_Holzschachtel.png"
    },
    {
        name: "Schokolade und Wein Geschenkkorb",
        bild: "Schokolade_und_Wein_Geschenkkorb",
        preis: 75.99,
        imWarenkorb: 0,
        id: 2,
        bildpfad: "Images/Geschenkset/Schokolade_und_Wein_Geschenkkorb.png"
    },
    {
        name: "Schokotorte",
        bild: "Schokotorte",
        preis: 27.85,
        imWarenkorb: 0,
        id: 3,
        bildpfad: "Images/Geschenkset/Schokotorte.png"
    },
    {
        name: "Schokowerkzeuge",
        bild: "Schokowerkzeuge",
        preis: 9.99,
        imWarenkorb: 0,
        id: 4,
        bildpfad: "Images/Geschenkset/Schokowerkzeuge.png"
    },
    {
        name: "Trueffel_Geschenkbox",
        bild: "Trueffel_Geschenkbox",
        preis: 4.75,
        imWarenkorb: 0,
        id: 5,
        bildpfad: "Images/Geschenkset/Trueffel_Geschenkbox.png"
    },
    { //Pralinen - Vollmilch
        name: "Triple Chocolate",
        bild: "Mix_aus_Weiss_und_Vollmilch_Dreierlei",
        preis: 3.50,
        imWarenkorb: 0,
        id: 6,
        bildpfad: "Images/Pralinen/Vollmilch/Mix_aus_Weiss_und_Vollmilch_Dreierlei.png"
    },
    {
        name: "Schokoladen Mouse - Traum",
        bild: "Mouse_gefuellte_Praline",
        preis: 2.90,
        imWarenkorb: 0,
        id: 7,
        bildpfad: "Images/Pralinen/Vollmilch/Mouse_gefuellte_Praline.png"
    },
    {
        name: "Lava Praline",
        bild: "Praline_mit_Mouse_und_fluessiger_Schokolade",
        preis: 0.30,
        imWarenkorb: 0,
        id: 8,
        bildpfad: "Images/Pralinen/Vollmilch/Praline_mit_Mouse_und_fluessiger_Schokolade.png"
    },
    {
        name: "Feine Erdbeere",
        bild: "Vollmilch_Praline_mit_Erbeertopping",
        preis: 0.30,
        imWarenkorb: 0,
        id: 9,
        bildpfad: "Images/Pralinen/Vollmilch/Vollmilch_Praline_Erdbeertopping.png"
    },
    {
        name: "Vollmilch Genussmix",
        bild: "Vollmilch_Praline_mit_Nuss_Karamell_oder_Zartbitter_Topping",
        preis: 0.25,
        imWarenkorb: 0,
        id: 10,
        bildpfad: "Images/Pralinen/Vollmilch/Vollmilch_Praline_mit_Nuss_Karamell_oder_Zartbitter_Topping.png"
    },
    {//Pralinen - Weiss
        name: "Schneeweiße Berge",
        bild: "Die_weissen_Berge",
        preis: 1.90,
        imWarenkorb: 0,
        id: 11,
        bildpfad: "Images/Pralinen/Weiss/Die_weissen_Berge.png"
    },
    {
        name: "Erdbeertraum",
        bild: "Erdbeertraum",
        preis: 0.33,
        imWarenkorb: 0,
        id: 12,
        bildpfad: "Images/Pralinen/Weiss/Erdbeertraum.png"
    },
    {
        name: "Fruchtiges Rendezvous",
        bild: "Gefuellte_Praline_mit_Mouse_Topping",
        preis: 0.33,
        imWarenkorb: 0,
        id: 13,
        bildpfad: "Images/Pralinen/Weiss/Gefuellte_Praline_mit_Mouse_Topping.png"
    },
    {
        name: "Feine Kokoskugel",
        bild: "Kokoskugel_mit_Nussfuellung",
        preis: 0.30,
        imWarenkorb: 0,
        id: 14,
        bildpfad: "Images/Pralinen/Weiss/Kokoskugel_mit_Nussfuellung.png"
    },
    {
        name: "Buttersahne-Trüffel",
        bild: "Praline_mit_Roellchen",
        preis: 0.30,
        imWarenkorb: 0,
        id: 15,
        bildpfad: "Images/Pralinen/Weiss/Praline_mit_Roellchen.png"
    },
    { //Pralinen - Zartbitte
        name: "Feinste Zartbitterkugeln",
        bild: "Drei_Schokokugeln",
        preis: 2.90,
        imWarenkorb: 0,
        id: 16,
        bildpfad: "Images/Pralinen/Zartbitter/Drei_Schokokugeln.png"
    },
    {
        name: "Erdbeer-Mouse - Traum",
        bild: "Mouse_gefuellt_mit_Erdbeerglasur",
        preis: 0.33,
        imWarenkorb: 0,
        id: 17,
        bildpfad: "Images/Pralinen/Zartbitter/Mouse_gefuellt_mit_Erdbeerglasur.png"
    },
    {
        name: "Flüssige Verführung",
        bild: "Praline_mit_fluessigem_Kern",
        preis: 0.33,
        imWarenkorb: 0,
        id: 18,
        bildpfad: "Images/Pralinen/Zartbitter/Praline_mit_fluessigem_Kern.png"
    },
    {
        name: "Goldschatz",
        bild: "Zartbitterkugel_mit_Goldglasur",
        preis: 0.25,
        imWarenkorb: 0,
        id: 19,
        bildpfad: "Images/Pralinen/Zartbitter/Zartbitterkugel_mit_Goldglasur.png"
    },
    {
        name: "Marzipan Traum",
        bild: "Zartbitterpraline",
        preis: 0.25,
        imWarenkorb: 0,
        id: 20,
        bildpfad: "Images/Pralinen/Zartbitter/Zartbitterpraline.png"
    },
    { //Tafeln - Vollmilch
        name: "Selbstgemachte Schokolade mit Erdbeer Streuseln oder Nuessen",
        bild: "Selbstgemachte_Schokolade_mit_Erdbeer_Streuseln_oder_Nuessen",
        preis: 3.99,
        imWarenkorb: 0,
        id: 21,
        bildpfad: "Images/Tafeln/Vollmilch/Selbstgemachte_Schokolade_mit_Erdbeer_Streuseln_oder_Nuessen.png"
    },
    {
        name: "Tafel mit Milchfuellung",
        bild: "Tafel_mit_Milchfuellung",
        preis: 2.49,
        imWarenkorb: 0,
        id: 22,
        bildpfad: "Images/Tafeln/Vollmilch/Tafel_mit_Milchfuellung.png"
    },
    {
        name: "Tafel Vollmilch",
        bild: "Tafel_Vollmilch",
        preis: 3.49,
        imWarenkorb: 0,
        id: 23,
        bildpfad: "Images/Tafeln/Vollmilch/Tafel_Vollmilch.png"
    },
    {
        name: "Vollmilchschokolade mit Nuessen und Kokos",
        bild: "Vollmilchschokolade_mit_Nuessen_und_Kokos",
        preis: 2.49,
        imWarenkorb: 0,
        id: 24,
        bildpfad: "Images/Tafeln/Vollmilch/Vollmilchschokolade_mit_Nuessen_und_Kokos.png"
    },
    {
        name: "Vollmilchschokolade mit Nuessen",
        bild: "Vollmilchschokolade_mit_Nuessen",
        preis: 3.49,
        imWarenkorb: 0,
        id: 25,
        bildpfad: "Images/Tafeln/Vollmilch/Vollmilchschokolade_mit_Nuessen.png"
    },
    { //Tafeln - Weiss
        name: "Luftschokolade",
        bild: "Luftschokolade",
        preis: 3.49,
        imWarenkorb: 0,
        id: 26,
        bildpfad: "Images/Tafeln/Weiss/Luftschokolade.png"
    },
    {
        name: "Tafeln mit Fruechten",
        bild: "Tafeln_mit_Fruechten",
        preis: 3.49,
        imWarenkorb: 0,
        id: 27,
        bildpfad: "Images/Tafeln/Weiss/Tafeln_mit_Fruechten.png"
    },
    {
        name: "Weiss und Vollmilch mit Erdbeer",
        bild: "Weiss_und_Vollmilch_mit_Erdbeer",
        preis: 3.99,
        imWarenkorb: 0,
        id: 28,
        bildpfad: "Images/Tafeln/Weiss/Tafeln_mit_Fruechten.png"
    },
    {
        name: "Weisse Schokolade mit Nuessen",
        bild: "Weisse_Schokolade_mit_Nuessen",
        preis: 3.99,
        imWarenkorb: 0,
        id: 29,
        bildpfad: "Images/Tafeln/Weiss/Weisse_Schokolade_mit_Nuessen.png"
    },
    {
        name: "Weisse Tafel",
        bild: "Weisse_Tafel",
        preis: 2.49,
        imWarenkorb: 0,
        id: 30,
        bildpfad: "Images/Tafeln/Weiss/Weisse_Tafel.png"
    },
    { //Tafeln - Zartbitter
        name: "Brownie Zartbittertafel",
        bild: "Brownie_Zartbittertafel",
        preis: 3.49,
        imWarenkorb: 0,
        id: 31,
        bildpfad: "Images/Tafeln/Zartbitter/Brownie_Zartbittertafel.png"
    },
    {
        name: "Chili Schokolade",
        bild: "Chili_Schokolade",
        preis: 3.99,
        imWarenkorb: 0,
        id: 32,
        bildpfad: "Images/Tafeln/Zartbitter/Chili_Schokolade.png"
    },
    {
        name: "Lindtschokolade",
        bild: "Lindtschokolade",
        preis: 3.49,
        imWarenkorb: 0,
        id: 33,
        bildpfad: "Images/Tafeln/Zartbitter/Lindtschokolade.png"
    },
    {
        name: "Zartbitterschokolade mit Nuessen",
        bild: "Zartbitterschokolade_mit_Nuessen",
        preis: 3.49,
        imWarenkorb: 0,
        id: 34,
        bildpfad: "Images/Tafeln/Zartbitter/Zartbitterschokolade_mit_Nuessen.png"
    },
    {
        name: "Zartbittertafel",
        bild: "Zartbittertafel",
        preis: 2.49,
        imWarenkorb: 0,
        id: 35,
        bildpfad: "Images/Tafeln/Zartbitter/Zartbittertafel.png"
    } //Produkte unter diesem Muster hinzufügen
]

var TestObProductPage = document.querySelectorAll(".produktbild");

function zumWarenkorb() {
    var x = document.querySelector("title");
    var productTEST = x.textContent;
    for (var i = 0; i < Produkte.length; i++) {
        if (productTEST == Produkte[i].bild) {
            var reminder = i;
        }
    }
    setItems(Produkte[reminder]);
    AusgabeEinkaufswagen();
}

function setItems(Produkte) {
    var ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK);
    var inputWithNumberOfItems = document.querySelector(".anzahl");
    var valueOfInput = inputWithNumberOfItems.value;
    valueOfInput = parseInt(valueOfInput);

    if (ItemsWK != null) {
        if (ItemsWK[Produkte.bild] == undefined) {
            ItemsWK = {
                ...ItemsWK,
                [Produkte.bild]: Produkte
            }
        }
        ItemsWK[Produkte.bild].imWarenkorb = ItemsWK[Produkte.bild].imWarenkorb + valueOfInput;
    } else {
        Produkte.imWarenkorb = valueOfInput;
        var ItemsWK = {
            [Produkte.bild]: Produkte
        } //erstellen der LS variable und setzung des attributes (?) .imWarenkorb auf die Eingabe im Input feld
    }
    localStorage.setItem("ProdukteImWK", JSON.stringify(ItemsWK))
}//erstellt variable im LocalStorage und erhöht diese um die Eingabe im Input


function AusgabeEinkaufswagen() {
    let ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK); //erstellt nutzbare variable mit den aktuellen Warenkorb inhalt


    let InhaltWarenkorb = document.querySelector(".InhaltWarenkorb");

    var ItemsWK2;
    var GesamtPreis2 = 0;

    for (var i = 0; i < Produkte.length; i++) {
        try {
            if (ItemsWK[Produkte[i].bild].bild == Produkte.bild) { } //erzwinge fehler um die Produkte im WK zu ermitteln (whacke lösung)
            var name = Produkte[i].bild;
            if (ItemsWK[name].imWarenkorb < 0) {
            } else {
                var namesWK2 = ItemsWK[name].bild;
                ItemsWK2 = {
                    ...ItemsWK2,
                    [namesWK2]: ItemsWK[namesWK2]
                }
                GesamtPreis2 += ItemsWK[namesWK2].preis * ItemsWK[namesWK2].imWarenkorb;
            }
        } catch (e) { }
    }

    GesamtPreis2 = GesamtPreis2.toFixed(2);


    if (ItemsWK2 && InhaltWarenkorb) { //checkt ob es die Warenkorb seite ist
        InhaltWarenkorb.innerHTML = "";
        Object.values(ItemsWK2).map(Item => {
            InhaltWarenkorb.innerHTML += `

                        <body>
                        <div class="warenkorbitem">
                        <div class="ProdukteWK"> 
                        <button class="produktentfernen" type="Entfernen" onclick="produktLoeschen(${Item.id})"> <h6>Produkt aus dem Warenkorb entfernen</h6> </button>
                        <div class="produktbildwk">
                        <img src ="${Item.bildpfad}"></img>
                        </div>
                        <h7>${Item.name}</h7>
                        
                        <div class="Preis">${(Item.preis).toFixed(2)} EUR / Stueck</div>
                        <div class="Anzahl">
                        <button class="anzahlbutton" type="einsWeniger" onclick="einsWeniger( ${Item.id} )"> Anzahl um 1 verringern </button>
                        Anzahl: ${Item.imWarenkorb}
                        <button class="anzahlbutton" type="einsMehr" onclick="einsMehr( ${Item.id} )"> Anzahl um 1 erhoehen </button>
                        </div>
                        <div class="Preise"> Teilpreis: ${(Item.imWarenkorb * Item.preis).toFixed(2)} EUR</div>
                        </div>
                        </div>
                        </body>
                        `
        });//erstellt html-code der den Warenkorb darstellt
        InhaltWarenkorb.innerHTML += `
            <div class="Gesamtpreis">
            <h4 class="GesamtpreisTitel"> Gesamtpreis:${GesamtPreis2} EUR </h4>
            </div>
            <button class="produktentfernen" type="WarenkorbLeeren" onclick="WarenkorbLeer()"> <h6>Warenkorb komplett leeren</h6></button>
            `
        //erstellt html-code der den Gesamtpreis darstellt
    } else {
        InhaltWarenkorb.innerHTML = "";
        InhaltWarenkorb.innerHTML += `<h3>Ihr Warenkorb ist leer!</h3>`;
    } //Wird nur ausgegeben wenn der Warenkorb leer ist
}

var TestObWarenkorb = document.querySelector(".InhaltWarenkorb");
if (TestObWarenkorb) {
    AusgabeEinkaufswagen();
}

function einsMehr(ProductID) {
    let ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK); //erstellt nutzbare variable mit den aktuellen Warenkorb inhalt
    for (var i = 0; i < Produkte.length; i++) {
        if (Produkte[i].id == ProductID) {
            var name = Produkte[i].bild;
        }
    }
    ItemsWK[name].imWarenkorb += 1;
    localStorage.setItem("ProdukteImWK", JSON.stringify(ItemsWK))
    AusgabeEinkaufswagen();
}

function einsWeniger(ProductID) {
    let ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK); //erstellt nutzbare variable mit den aktuellen Warenkorb inhalt
    for (var i = 0; i < Produkte.length; i++) {
        if (Produkte[i].id == ProductID) {
            var name = Produkte[i].bild;
        }
    }
    ItemsWK[name].imWarenkorb -= 1;
    localStorage.setItem("ProdukteImWK", JSON.stringify(ItemsWK))
    AusgabeEinkaufswagen();
}

function WarenkorbLeer() {
    localStorage.clear();
    AusgabeEinkaufswagen();
}


function imWKcleaner() {
    let ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK);
    let test;
    for (var num = 0; i < Produkte.length; i++) {
        if (ProductID == Produkte[i].id) {
            var test2 = ItemsWK.valueOf(`"imWarenkorb":`, +2);
            console.log(test2);
        }
    }
}

function produktLoeschen(ProductID) {
    for (var i = 0; i < Produkte.length; i++) {
        if (Produkte[i].id == ProductID) {
            var name = Produkte[i].bild;
        }
    }
    let ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK);
    ItemsWK[name].imWarenkorb = -1;
    localStorage.setItem("ProdukteImWK", JSON.stringify(ItemsWK));
    AusgabeEinkaufswagen();
}

//TODO: Button entwicklen um nur ein Item aus dem WK zu löschen
//TODO: Items bei dem .inWarenkorb <= 0 ist aus der NodeList killen
// -> jeden eintrag als Array speichern -> att checken -> löschen -> neu als Nodelist in LS speicher (???)