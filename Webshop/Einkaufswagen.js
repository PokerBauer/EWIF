var Produkte = [
    { //Geschenkset
        name: "Schokoadventskalender_in_Holzschachtel",
        bild: "Schokoadventskalender_in_Holzschachtel",
        preis: 1,
        imWarenkorb: 0
    },
    {
        name: "Schokolade_und_Wein_Geschenkkorb",
        bild: "Schokolade_und_Wein_Geschenkkorb",
        preis: 2,
        imWarenkorb: 0
    },
    {
        name: "Schokotorte",
        bild: "Schokotorte",
        preis: 3,
        imWarenkorb: 0
    },
    {
        name: "Schokowerkzeuge",
        bild: "Schokowerkzeuge",
        preis: 4,
        imWarenkorb: 0
    },
    {
        name: "Trueffel_Geschenkbox",
        bild: "Trueffel_Geschenkbox",
        preis: 5,
        imWarenkorb: 0
    },
    { //Pralinen - Vollmilch
        name: "Mix_aus_Weiss_und_Vollmilch_Dreierlei",
        bild: "Mix_aus_Weiss_und_Vollmilch_Dreierlei",
        preis: 6,
        imWarenkorb: 0
    },
    {
        name: "Mouse_gefuellte_Praline",
        bild: "Mouse_gefuellte_Praline",
        preis: 7,
        imWarenkorb: 0
    },
    {
        name: "Praline_mit_Mouse_und_fluessiger_Schokolade",
        bild: "Praline_mit_Mouse_und_fluessiger_Schokolade",
        preis: 8,
        imWarenkorb: 0
    },
    {
        name: "Vollmilch_Praline_Erdbeertopping",
        bild: "Vollmilch_Praline_Erdbeertopping",
        preis: 9,
        imWarenkorb: 0
    },
    { //Pralinen - Weiss
        name: "Vollmilch_Praline_mit_Nuss_Karamell_oder_Zartbitter_Topping",
        bild: "Vollmilch_Praline_mit_Nuss_Karamell_oder_Zartbitter_Topping",
        preis: 10,
        imWarenkorb: 0
    },
    {
        name: "Die_weissen_Berge",
        bild: "Die_weissen_Berge",
        preis: 11,
        imWarenkorb: 0
    },
    {
        name: "Erdbeertraum",
        bild: "Erdbeertraum",
        preis: 12,
        imWarenkorb: 0
    },
    {
        name: "Gefuellte_Praline_mit_Mouse_Topping",
        bild: "Gefuellte_Praline_mit_Mouse_Topping",
        preis: 13,
        imWarenkorb: 0
    },
    {
        name: "Kokoskugel_mit_Nussfuellung",
        bild: "Kokoskugel_mit_Nussfuellung",
        preis: 14,
        imWarenkorb: 0
    },
    {
        name: "Praline_mit_Roellchen",
        bild: "Praline_mit_Roellchen",
        preis: 15,
        imWarenkorb: 0
    },
    { //Pralinen - Zartbitte
        name: "Drei_Schokokugeln",
        bild: "Drei_Schokokugeln",
        preis: 16,
        imWarenkorb: 0
    },
    {
        name: "Mouse_gefuellt_mit_Erdbeerglasur",
        bild: "Mouse_gefuellt_mit_Erdbeerglasur",
        preis: 17,
        imWarenkorb: 0
    },
    {
        name: "Praline_mit_fluessigem_Kern",
        bild: "Praline_mit_fluessigem_Kern",
        preis: 18,
        imWarenkorb: 0
    },
    {
        name: "Zartbitterkugel_mit_Goldglasur",
        bild: "Zartbitterkugel_mit_Goldglasur",
        preis: 19,
        imWarenkorb: 0
    },
    {
        name: "Zartbitterpraline",
        bild: "Zartbitterpraline",
        preis: 20,
        imWarenkorb: 0
    },
    { //Tafeln - Vollmilch
        name: "Selbstgemachte_Schokolade_mit_Erdbeer_Streuseln_oder_Nuessen",
        bild: "Selbstgemachte_Schokolade_mit_Erdbeer_Streuseln_oder_Nuessen",
        preis: 21,
        imWarenkorb: 0
    },
    {
        name: "Tafel_mit_Tafelfuellung",
        bild: "Tafel_mit_Tafelfuellung",
        preis: 22,
        imWarenkorb: 0
    },
    {
        name: "Tafel_Vollmilch",
        bild: "Tafel_Vollmilch",
        preis: 23,
        imWarenkorb: 0
    },
    {
        name: "Vollmilchschokolade_mit_Nuessen_und_Kokos",
        bild: "Vollmilchschokolade_mit_Nuessen_und_Kokos",
        preis: 24,
        imWarenkorb: 0
    },
    {
        name: "Vollmilchschokolade_mit_Nuessen",
        bild: "Vollmilchschokolade_mit_Nuessen",
        preis: 25,
        imWarenkorb: 0
    },
    { //Tafeln - Weiss
        name: "Luftschokolade",
        bild: "Luftschokolade",
        preis: 26,
        imWarenkorb: 0
    },
    {
        name: "Tafeln_mit_Fruechten",
        bild: "Tafeln_mit_Fruechten",
        preis: 27,
        imWarenkorb: 0
    },
    {
        name: "Weiss_und_Vollmilch_mit_Erdbeer",
        bild: "Weiss_und_Vollmilch_mit_Erdbeer",
        preis: 28,
        imWarenkorb: 0
    },
    {
        name: "Weisse_Schokolade_mit_Nuessen",
        bild: "Weisse_Schokolade_mit_Nuessen",
        preis: 29,
        imWarenkorb: 0
    },
    {
        name: "Weisse_Tafel",
        bild: "Weisse_Tafel",
        preis: 30,
        imWarenkorb: 0
    },
    { //Tafeln - Zartbitter
        name: "Brownie_Zartbittertafel",
        bild: "Brownie_Zartbittertafel",
        preis: 31,
        imWarenkorb: 0
    },
    {
        name: "Chili_Schokolade",
        bild: "Chili_Schokolade",
        preis: 32,
        imWarenkorb: 0
    },
    {
        name: "Lindtschokolade",
        bild: "Lindtschokolade",
        preis: 33,
        imWarenkorb: 0
    },
    {
        name: "Zartbitterschokolade_mit_Nuessen",
        bild: "Zartbitterschokolade_mit_Nuessen",
        preis: 34,
        imWarenkorb: 0
    },
    {
        name: "Zartbittertafel",
        bild: "Zartbittertafel",
        preis: 35,
        imWarenkorb: 0 
    } //Produkte unter diesem Muster hinzufügen
]//bild soll der Bildname sein -> zum nuten in AusgabeEinkaufswagen(),   TODO: anpassen an richtige Preise

var TestObProductPage = document.querySelectorAll(".produktbild");

/*
if(TestObProductPage) {
    var x = document.querySelector("title");
    var productTEST = x.textContent;

    for(var i = 0; i < Produkte.length; i++) {
        if(productTEST == Produkte[i].name) {
            var reminder = i;
            console.log(reminder);
        }
    }

    /*

    var button = document.querySelectorAll(".Warenkorb");
    //var button = document.getElementById("button");

    console.log(button);

    //nur der button

    for(var p = 0; p <= 1; p++) {
        button[p].addEventListener("click", event => {
            AnzahlItems(Produkte[reminder]);
            GesamtPreis(Produkte[reminder]);
            AusgabeEinkaufswagen();
        });
    }
    
}
*/

function clickTest(){
    var x = document.querySelector("title");
    var productTEST = x.textContent;

    for(var i = 0; i < Produkte.length; i++) {
        if(productTEST == Produkte[i].name) {
            var reminder = i;
            //console.log(reminder);
        }
    }

    AnzahlItems(Produkte[reminder]);
    GesamtPreis(Produkte[reminder]);
    AusgabeEinkaufswagen();
}


function AnzahlItems(Produkte) {

    console.log("InAnzahlItems");

    var anzahlProdukte = localStorage.getItem("AnzahlItemsWarenkorb");
    anzahlProdukte = parseInt(anzahlProdukte);

    var testing101 = document.querySelector(".anzahl");

    var numberTesting = testing101.value;
    numberTesting = parseInt(numberTesting);

    console.log(numberTesting);



    //localStorage.setItem("AnzahlItemsWarenkorb", math);

    if (anzahlProdukte) {
        localStorage.setItem("AnzahlItemsWarenkorb", anzahlProdukte + numberTesting);
        } else {
        localStorage.setItem("AnzahlItemsWarenkorb", 1);
    }

    setItems(Produkte);
} //zähler für die anzahl der Prdoukte im WK im LocalStorage


function setItems(Produkte) {
    var ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK);
    if(ItemsWK != null) { //wenn bereits vorhanden ist
        if(ItemsWK[Produkte.bild] == undefined) {
            ItemsWK = {
                ItemsWK,
                [Produkte.bild] : Produkte
            }
        }
        ItemsWK[Produkte.bild].imWarenkorb = ItemsWK[Produkte.bild].imWarenkorb + 1;
    } else {
        Produkte.imWarenkorb = 1; 
        var ItemsWK = {
            [Produkte.bild] : Produkte
        } //erstellen der LS variable und setzung des attributes (?) .imWarenkorb auf 1
    }
    localStorage.setItem("ProdukteImWK", JSON.stringify(ItemsWK))
}//erstellt variable im LocalStorage und erhöht diese um 1 falls diese bereits vorhanden ist

function GesamtPreis(Produkt) {
    let TeilPreis = localStorage.getItem("GesamtPreis"); 

    if(TeilPreis != null) {
        TeilPreis = parseInt(TeilPreis);
        localStorage.setItem("GesamtPreis", TeilPreis+Produkt.preis); //erhöht den Preis um den neuen Produkt preis
    } else {
        localStorage.setItem("GesamtPreis", Produkt.preis); //setzt beim erst durchlauf den preis
    }
} //berechnet den Gesamtpreis des Einkaufes

function AusgabeEinkaufswagen(){
    let ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK); //erstellt nutzbare variable mit den aktuellen Warenkorb inhalt

    let InhaltWarenkorb = document.querySelector(".InhaltWarenkorb");
    if(ItemsWK && InhaltWarenkorb)  { //checkt ob es die Warenkorb seite ist
        InhaltWarenkorb.innerHTML = "";
        Object.values(ItemsWK).map(Item => {
            InhaltWarenkorb.innerHTML += `
            <div class="PrdukteWK"> 
            <button type="Entfernen"> Entfernen </button>
                <img src ="Images/${Item.bild}.jpg"></img>
                <span>${Item.name}</span>
            </div>
            <div class="Preis">${Item.preis},00 Euro</div>
            <div class="Anzahl">
            <button type="einsWeniger"> -1 </button>
            ${Item.imWarenkorb}
            <button type="einsMehr"> +1 </button>
            </div>

            <div class="Preise"> Teilpreis:${Item.imWarenkorb*Item.preis},00 Euro</div>
            `

            //span als extra div ?
            //erstellt html-code der den Warenkorb darstellt
        });
        let TeilPreis = localStorage.getItem("GesamtPreis");
        InhaltWarenkorb.innerHTML += `
        <div class="Gesamtpreis">
        <h4 class="GesamtpreisTitel"> Gesamtpreis:${TeilPreis},00 Euro € </h4>
        </div>
        `
        //erstellt html-code der den Gesamtpreis darstellt
        //TODO: €, ß in html ordentlich anzeigen lassen
    }
}

var TestObWarenkorb = document.querySelector(".InhaltWarenkorb");
if(TestObWarenkorb) { //checkt ob es die Warenkorb seite ist
    AusgabeEinkaufswagen(); 
} //ausgabe des warnkorbs beim laden der Warenkorbseite

/*
TODO:
58: anpassen an richtige Preise + richtige Bildnamen und ß schreibbar machen + 58 die tags auf die neuen 15 anpassen
145: €, ß in html ordentlich anzeigen lassen
160+: Die Buttons zum entfernen, +1 und -1 müssen noch entwickelt werden
-> Funktion in Funktion? //rausfinden wie zugriff auf Button innerhalb einer Textausgabe funktionier -> notfalls umschreiben!
*/
//Experimente für die Buttons:

function KomplettEntfernen(Produkt) {
    console.log("in KomplettEntfernen")
    var ItemsWK = localStorage.getItem("ProdukteImWK");
    ItemsWK = JSON.parse(ItemsWK);
    ItemsWK[Produkt].imWarenkorb = 0;
} 

let btnMehr = document.querySelector(".einsMehr");
console.log(btnMehr); 